---
const navLinks = [
  { label: 'Servicios', href: '/servicios' },
  { label: 'Nosotros', href: '/nosotros' },
  { label: 'Museo', href: '/nosotros#museo' },
  { label: 'ReCreo', href: '/recreo' },
  { label: 'Dashboard', href: '/reportes' },
  { label: 'Locaciones', href: '/locaciones' },
  { label: 'Empleos', href: '/empleos' },
  { label: 'Blog', href: '/blog' },
]
---

<header id="site-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-500">
  <!-- 30 Years Banner -->
  <div id="top-banner" class="bg-gradient-to-r from-rdn-blue via-rdn-blue-dark to-rdn-blue text-white py-2 text-center relative overflow-hidden">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg width=%2220%22 height=%2220%22 viewBox=%220 0 20 20%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cg fill=%22%23ffffff%22 fill-opacity=%220.05%22%3E%3Ccircle cx=%2210%22 cy=%2210%22 r=%221%22/%3E%3C/g%3E%3C/svg%3E')]"></div>
    <div class="relative flex items-center justify-center gap-3 px-4">
      <span class="text-rdn-green font-bold text-sm">&#9733;</span>
      <p class="text-xs sm:text-sm font-semibold tracking-wide">
        Celebrando <span class="text-rdn-green font-bold">30 Años</span> de Reciclaje en Puerto Rico
        <span class="text-white/60 hidden sm:inline">&mdash; 1996-2026 &bull; Corporación Comunitaria</span>
      </p>
      <span class="text-rdn-red font-bold text-sm">&#9733;</span>
    </div>
  </div>

  <div class="mx-auto max-w-[1440px] px-6 md:px-12 lg:px-20">
    <nav class="flex items-center justify-between h-20 md:h-24">
      <!-- Logo -->
      <a href="/" class="relative z-[60] flex items-center gap-2 group header-logo-link">
        <img src="/images/rdn-logo.svg" alt="RDN - Reciclaje del Norte" class="h-10 md:h-12 w-auto transition-all duration-300 group-hover:scale-105" />
      </a>

      <!-- Desktop nav -->
      <div class="hidden lg:flex items-center gap-1">
        {navLinks.map(link => (
          <a
            href={link.href}
            class="px-5 py-2 text-sm font-medium header-link-color transition-colors duration-300 rounded-full hover:bg-white/10"
          >
            {link.label}
          </a>
        ))}
      </div>

      <!-- CTA + Mobile toggle -->
      <div class="flex items-center gap-4">
        <a href="/contacto" class="hidden md:inline-flex items-center gap-2 bg-rdn-blue text-white px-6 py-2.5 rounded-full text-sm font-semibold transition-all duration-300 hover:bg-rdn-blue-light hover:shadow-lg hover:-translate-y-0.5">
          Cotización
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>

        <!-- Mobile menu button -->
        <button id="mobile-toggle" class="lg:hidden relative z-[60] w-10 h-10 flex flex-col items-center justify-center gap-1.5" aria-label="Menú">
          <span class="burger-line burger-top w-6 h-0.5 bg-current header-text-color transition-all duration-300 origin-center"></span>
          <span class="burger-line burger-mid w-6 h-0.5 bg-current header-text-color transition-all duration-300 origin-center"></span>
          <span class="burger-line burger-bot w-4 h-0.5 bg-current header-text-color transition-all duration-300 origin-center"></span>
        </button>
      </div>
    </nav>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="lg:hidden fixed inset-0 bg-rdn-green-dark/98 backdrop-blur-xl -webkit-backdrop-blur-xl z-50 opacity-0 pointer-events-none transition-all duration-300 flex items-center justify-center" style="-webkit-backdrop-filter: blur(24px);">
    <nav class="text-center space-y-2">
      {navLinks.map((link, i) => (
        <a
          href={link.href}
          class="block text-4xl md:text-5xl font-bold text-white py-3 active:text-rdn-lime transition-colors duration-150"
        >
          {link.label}
        </a>
      ))}
      <div class="pt-8">
        <a href="/contacto" class="btn-lime">
          Contáctanos
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>
      </div>
      <div class="pt-8 flex justify-center gap-6">
        <a href="tel:787-262-0305" class="text-white/60 hover:text-rdn-lime text-sm transition-colors">787-262-0305</a>
        <a href="mailto:serviciosrdn@reciclajedelnorte.com" class="text-white/60 hover:text-rdn-lime text-sm transition-colors">Email</a>
      </div>
    </nav>
  </div>
</header>

<style>
  /* Hide banner when scrolled */
  #site-header.scrolled #top-banner {
    display: none;
  }

  /* Default (transparent over dark hero) */
  .header-text-color { color: white; }
  .header-subtext-color { color: rgba(255,255,255,0.7); }
  .header-link-color { color: rgba(255,255,255,0.85); }

  /* Logo gets a soft white pill behind it so colors are readable on dark hero */
  .header-logo-link {
    background: rgba(255, 255, 255, 0.85);
    padding: 4px 10px;
    border-radius: 10px;
    transition: background 0.3s, box-shadow 0.3s;
  }

  /* Scrolled state — white bar, no pill needed */
  #site-header.scrolled {
    background-color: rgba(255, 255, 255, 0.97);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.08);
  }

  #site-header.scrolled .header-logo-link {
    background: transparent;
    padding: 4px 0;
  }

  #site-header.scrolled .header-text-color { color: #1A1A1A; }
  #site-header.scrolled .header-subtext-color { color: #6B7280; }
  #site-header.scrolled .header-link-color { color: #1A1A1A; }
  #site-header.scrolled .header-link-color:hover { color: #0062AD; }

  /* Mobile open state */
  #mobile-menu.open {
    opacity: 1;
    pointer-events: auto;
  }

  /* When mobile menu is open, keep logo pill visible on dark green */
  #site-header.menu-open .header-logo-link {
    background: rgba(255, 255, 255, 0.9);
    padding: 4px 10px;
  }

  /* Burger to X animation when menu is open */
  #mobile-toggle.open .burger-top {
    transform: translateY(4px) rotate(45deg);
    color: white;
  }
  #mobile-toggle.open .burger-mid {
    opacity: 0;
    transform: scaleX(0);
    color: white;
  }
  #mobile-toggle.open .burger-bot {
    width: 1.5rem;
    transform: translateY(-4px) rotate(-45deg);
    color: white;
  }
</style>

<script>
  const header = document.getElementById('site-header')!
  const toggle = document.getElementById('mobile-toggle')!
  const menu = document.getElementById('mobile-menu')!

  // Scroll handler
  const onScroll = () => {
    if (window.scrollY > 80) {
      header.classList.add('scrolled')
    } else {
      header.classList.remove('scrolled')
    }
  }
  window.addEventListener('scroll', onScroll, { passive: true })
  onScroll()

  // Mobile menu toggle
  let touched = false

  const closeMenu = () => {
    menu.classList.remove('open')
    toggle.classList.remove('open')
    header.classList.remove('menu-open')
    document.body.style.overflow = ''
  }

  const openMenu = () => {
    menu.classList.add('open')
    toggle.classList.add('open')
    header.classList.add('menu-open')
    document.body.style.overflow = 'hidden'
  }

  const handleToggle = () => {
    if (menu.classList.contains('open')) {
      closeMenu()
    } else {
      openMenu()
    }
  }

  // Use touchend on iOS, click as fallback — prevent double-fire
  toggle.addEventListener('touchend', (e) => {
    e.preventDefault()
    touched = true
    handleToggle()
  })

  toggle.addEventListener('click', (e) => {
    if (touched) { touched = false; return }
    handleToggle()
  })

  // Close menu and navigate IMMEDIATELY on link tap
  menu.querySelectorAll('a').forEach(link => {
    link.addEventListener('touchend', (e) => {
      e.preventDefault()
      closeMenu()
      window.location.href = (link as HTMLAnchorElement).href
    })
    link.addEventListener('click', () => {
      closeMenu()
    })
  })
</script>
